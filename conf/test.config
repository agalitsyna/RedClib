params {
    config_profile_name        = 'Test profile'
    config_profile_description = 'Minimal test dataset to check pipeline function'

    // Limit resources so that this can run CI
    max_cpus   = 10
    max_memory = '12.GB'
    max_time   = '6.h'

    publish_dir_mode = 'copy'

    // Input data
    input = '/home/agalicina/soft/sandbox/RedClib_dsl2_test/samplesheet.csv'                                //required
    chunksize = 10000                                           //optional

    genome {
        assembly = 'hg38'                                      //required
        auto_download_genome = false                           //optional
        chromsizes = '/home/agalicina/soft/sandbox/RedClib_dsl2_test/data/genome/hg38.reduced.chrom.sizes'  //optional
        index_prefix = '/home/agalicina/soft/sandbox/RedClib_dsl2_test/data/genome/hg38'                    //optional
        fasta = '/home/agalicina/soft/sandbox/RedClib_dsl2_test/data/genome/hg38.fa'                        //optional
        genes_gtf = 'ftp://ftp.ebi.ac.uk/pub/databases/gencode/Gencode_human/release_19/gencode.v19.chr_patch_hapl_scaff.annotation.gtf.gz' //required
        rna_annotation_suffix = 'gencode.v19'                 //optional
        restricted {                                          // optional, might be incomplete list:
            //DpnII   = '/home/agalicina/soft/sandbox/RedClib_dsl2_test/data/genome/hg38.DpnII.bed'
            //HindIII = '/home/agalicina/soft/sandbox/RedClib_dsl2_test/data/genome/hg38.HindIII.bed'
            MmeI    = '/home/agalicina/soft/sandbox/RedClib_dsl2_test/data/genome/hg38.MmeI.bed'
        }
    }

    check_restriction = true
    protocol {
        renzymes = ['DpnII', 'HindIII', 'MmeI']
    }

    dedup_crop = 50
    trimmomatic_params = "SLIDINGWINDOW:5:26 MINLEN:0"

    // Scheme of oligos mappingm you may specify other oligos:
    oligos {
        bridge_forward {  // these the parameters are required for each oligo:
            file = '/home/agalicina/soft/sandbox/RedClib_dsl2_test/data/oligos/br_37_for.fasta'
            n_oligos = 1 // Number of oligos in the file
            side = 1 // Apply the search to the side of the reads
            right_allowed_shift = -14 // Minimum distance to the right side of the read after which the search in the read will be terminated
            left_allowed_shift = 0 // Minimum distance to the left side of the read when the search will be started
            mismatches_allowed = 1 // Number of mismatches allowed
            expected_length = 20 // Expected length of oligo hit
        }
        bridge_reverse {
            file = '/home/agalicina/soft/sandbox/RedClib_dsl2_test/data/oligos/br_37_rev.fasta'
            n_oligos = 1
            side = 2
            right_allowed_shift = -14
            left_allowed_shift = 0
            mismatches_allowed = 1
            expected_length = 20
        }
        ggg {
            file = '/home/agalicina/soft/sandbox/RedClib_dsl2_test/data/oligos/ggg.fasta'
            n_oligos = 1
            side = 2
            right_allowed_shift = 3 // For the start of read
            left_allowed_shift = 0
            mismatches_allowed = 0
            expected_length = 3
        }
        adaptor_forward {
            file = '/home/agalicina/soft/sandbox/RedClib_dsl2_test/data/oligos/for_20.fasta'
            n_oligos = 2
            side = 1
            right_allowed_shift = -14
            left_allowed_shift = -6
            mismatches_allowed = 1
            expected_length = 20
        }
        adaptor_forward_r2 {
            file = '/home/agalicina/soft/sandbox/RedClib_dsl2_test/data/oligos/for_20.fasta'
            n_oligos = 2
            side = 2
            right_allowed_shift = -14
            left_allowed_shift = -6
            mismatches_allowed = 1
            expected_length = 20
        }
        adaptor_reverse {
            file = '/home/agalicina/soft/sandbox/RedClib_dsl2_test/data/oligos/rev_20.fasta'
            n_oligos = 2
            side = 2
            right_allowed_shift = -14
            left_allowed_shift = -6
            mismatches_allowed = 1
            expected_length = 20
        }
        adaptor_reverse_short {
            file = '/home/agalicina/soft/sandbox/RedClib_dsl2_test/data/oligos/rev_20.fasta'
            n_oligos = 2
            side = 1
            right_allowed_shift = -14
            left_allowed_shift = 0
            mismatches_allowed = 1
            expected_length = 16
        }
    }

    fragments {
        dna {
            side = 1 // forward or reverse
            extension_suffix = "GATC" // Optional parameter, extension might be removed if not needed
            new_columns { // expressions to be evaluated and stored under following keys; positions numbering starts from 0, should output int
                dna_start = "np.where( (end_hit__adaptor_forward_R1!=99999), end_hit__adaptor_forward_R1, 0)"
                dna_end = "np.where( (start_hit__bridge_forward_R1<pos_R1__trim), start_hit__bridge_forward_R1, pos_R1__trim)"
                dna_length = "dna_end-dna_start"
            }
            selection_criteria = "dna_length>14" // write fragment to the file only if condition is satisfies
        }
        rna1 {
            side = 1
            new_columns {
                rna1_start = "np.array( [pos_R1__trim, start_hit__bridge_forward_R1+37] ).min(axis=0)"
                rna1_end = "np.array( [pos_R1__trim, end_hit__complementary_R1, start_hit__adaptor_reverse_short_R1] ).min(axis=0)"
                rna1_length = "rna1_end-rna1_start"
            }
            selection_criteria = "rna1_length>14"
        }
        rna2 {
            side = 2
            new_columns {
                rna2_start = "np.array( [pos_R2__trim, np.maximum( np.where( (end_hit__ggg_R2!=99999), end_hit__ggg_R2, 0), np.where( (end_hit__adaptor_forward_r2_R2!=99999), end_hit__adaptor_forward_r2_R2, 0) )] ).min(axis=0)"
                rna2_end = "np.array( [pos_R2__trim, start_hit__bridge_reverse_R2, end_hit__complementary_R2] ).min(axis=0)"
                rna2_length = "rna2_end-rna2_start"
            }
            selection_criteria = "rna2_length>14"
        }
    }

    cooler_resolution = 1000000

}